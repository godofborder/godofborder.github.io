{"title":"从0开始搭建抓取CQU教务网的爬虫","uid":"7128c5ade60c9916a830dffb27b42426","slug":"cquspider","date":"2023-03-10T14:27:00.000Z","updated":"2023-03-10T14:44:34.750Z","comments":true,"path":"api/articles/cquspider.json","keywords":null,"cover":"http://www.ittc.cqu.edu.cn/__local/9/34/A4/6E9DEDBF1AB1DA238AAFF1EC9FB_0EF3B756_1ABBB.jpg","content":"<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">注意</p>\n<p>本文仍在更新中，内容尚缺！</p>\n</div>\n<h1 id=\"0-Prologue\"><a href=\"#0-Prologue\" class=\"headerlink\" title=\"0. Prologue\"></a>0. Prologue</h1><h2 id=\"0-1-想法の诞生\"><a href=\"#0-1-想法の诞生\" class=\"headerlink\" title=\"0.1 想法の诞生\"></a>0.1 想法の诞生</h2><p>其实有这个想法很久了，最开始时在蓝盟的通知群里的学长大佬做的单子推送BOT和教务等信息BOT，但当时没有什么基础，高中学了几个月C++的早忘了，直到大一下才学了一学期Python，期间我也在同学群里部署过一些QQ机器人( <a href=\"https://github.com/nonebot/nonebot2\">nonebot</a>,  <a href=\"https://github.com/Ice-Cirno/HoshinoBot\">hoshinobot</a>等)，虽说现在也忘了许多了，但是还是决定捡起来，从图书馆找了本爬虫入门到入土的书，开整！</p>\n<h2 id=\"0-2-大致框架\"><a href=\"#0-2-大致框架\" class=\"headerlink\" title=\"0.2 大致框架\"></a>0.2 大致框架</h2><p>Python脚本部分、cqhttp机器人对接qq协议、nonebot机器人主体、MySQL数据存储部分<br>下面我会通过各部分逐步完成此项目</p>\n<h1 id=\"1-通过urllib库实现简单的对教务通知的抓取\"><a href=\"#1-通过urllib库实现简单的对教务通知的抓取\" class=\"headerlink\" title=\"1. 通过urllib库实现简单的对教务通知的抓取\"></a>1. 通过urllib库实现简单的对教务通知的抓取</h1><p>简析：通过urllib请求教务网页具体内容，再通过lxml中的html模块对内容中特定部分进行抓取</p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">import urllib.request\nimport urllib\nimport urllib.parse\nfrom lxml import etree\nimport lxml.html\n\n#教务处站点\nbaseurl&#x3D;&quot;http:&#x2F;&#x2F;jwc.cqu.edu.cn&quot;\n\n#获取通知站点\ngeturl&#x3D;&quot;http:&#x2F;&#x2F;jwc.cqu.edu.cn&#x2F;index&#x2F;tzgg.htm&quot;\n\n#具体获取的对象\nnoticetitle&#x3D;[]\nnoticeurlst&#x3D;[]\n\n#请求头\nheaders&#x3D;&#123;&#39;User-Agent&#39;: &#39;Chrome&#x2F;63.0.3239.84 Safari&#x2F;537.36&#39;\n        &#39;Referer&#39; &#39;http:&#x2F;&#x2F;jwc.cqu.edu.cn&#39;\n        &#39;Connection&#39; &#39;keep-alive&#39;\n        &#125;\n\n#获取通知列表\ndef fetch_notice_urls():\n    req&#x3D;urllib.request.Request(url&#x3D;geturl,headers&#x3D;headers)\n    html&#x3D;lxml.html.parse(urllib.request.urlopen(req))\n    titles&#x3D;html.xpath(&#39;&#x2F;&#x2F;div[@class&#x3D;&quot;page-contner fl&quot;]&#x2F;ul&#x2F;li&#x2F;a&#x2F;text()&#39;)    #找到通知标题对应标签\n    orihrefs&#x3D;html.xpath(&#39;&#x2F;&#x2F;div[@class&#x3D;&quot;page-contner fl&quot;]&#x2F;ul&#x2F;li&#x2F;a&#x2F;@href&#39;)    #找到通知的具体链接对应标签\n    for urls in orihrefs:\n        noticeurlst.append(urls.replace(&quot;..&quot;, baseurl))    #将链接中的..替换为带有前缀的网址\n    with open(&#39;.&#x2F;fetch&#x2F;cqujwcres.txt&#39;,&quot;w+&quot;,encoding&#x3D;&#39;utf-8&#39;) as f:    #写入到本地\n        for i in range(len(titles)):\n            f.write(titles[i] + &quot;:\\t&quot; + noticeurlst[i] + &quot;\\n&quot;)\n\n#执行\nif __name__ &#x3D;&#x3D; &#39;__main__&#39;:\n    fetch_notice_urls()</code></pre>\n\n<p>通过以上代码，我们可以将教务信息第一页中的通知及其对应链接下载到本地，实现一个简单的抓取过程</p>\n<h1 id=\"2-使用request库对教务网所有通知进行抓取\"><a href=\"#2-使用request库对教务网所有通知进行抓取\" class=\"headerlink\" title=\"2. 使用request库对教务网所有通知进行抓取\"></a>2. 使用request库对教务网所有通知进行抓取</h1><p>This Part is <strong>UNDER CONSTRUCTION</strong>.</p>\n","feature":true,"text":" 注意 本文仍在更新中，内容尚缺！ 0. Prologue0.1 想法の诞生其实有这个想法很久了，最开始时在蓝盟的通知群里的学长大佬做的单子推送BOT和教务等信息BOT，但当时没有什么基础，高中学了几个月C++的早忘了，直到大一下才学了一学期Python，期间我也在同学群里部署过...","link":"","photos":[],"count_time":{"symbolsCount":"1.9k","symbolsTime":"2 mins."},"categories":[{"name":"Coding","slug":"Coding","count":1,"path":"api/categories/Coding.json"},{"name":"Python","slug":"Coding/Python","count":1,"path":"api/categories/Coding/Python.json"}],"tags":[{"name":"weekly","slug":"weekly","count":4,"path":"api/tags/weekly.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#0-Prologue\"><span class=\"toc-text\">0. Prologue</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0-1-%E6%83%B3%E6%B3%95%E3%81%AE%E8%AF%9E%E7%94%9F\"><span class=\"toc-text\">0.1 想法の诞生</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0-2-%E5%A4%A7%E8%87%B4%E6%A1%86%E6%9E%B6\"><span class=\"toc-text\">0.2 大致框架</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#1-%E9%80%9A%E8%BF%87urllib%E5%BA%93%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E5%AF%B9%E6%95%99%E5%8A%A1%E9%80%9A%E7%9F%A5%E7%9A%84%E6%8A%93%E5%8F%96\"><span class=\"toc-text\">1. 通过urllib库实现简单的对教务通知的抓取</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#2-%E4%BD%BF%E7%94%A8request%E5%BA%93%E5%AF%B9%E6%95%99%E5%8A%A1%E7%BD%91%E6%89%80%E6%9C%89%E9%80%9A%E7%9F%A5%E8%BF%9B%E8%A1%8C%E6%8A%93%E5%8F%96\"><span class=\"toc-text\">2. 使用request库对教务网所有通知进行抓取</span></a></li></ol>","author":{"name":"Krodnel","slug":"blog-author","avatar":"https://s1.ax1x.com/2022/03/06/brFqER.png","link":"/","description":"I don't live in a dream <br /> The dream is my reality","socials":{"github":"https://github.com/godofborder","twitter":"https://twitter.com/godofborder","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili-line.svg","link":"https://space.bilibili.com/34360575"},"QQ":{"icon":"/svg/QQ.svg","link":"http://wpa.qq.com/msgrd?v=3&uin=2632954297&site=qq&menu=yes"},"netease":{"icon":"/svg/netease.svg","link":"http://music.163.com/playlist?id=688977586&userid=337229589"},"steam":{"icon":"/svg/steam.svg","link":"https://steamcommunity.com/id/Krodnel/"}}}},"mapped":true,"prev_post":{"title":"喧嚣过后","uid":"2abbb626d7d11e908aa05da8d9928836","slug":"2023-mar","date":"2023-03-10T14:59:07.000Z","updated":"2023-03-10T15:01:44.395Z","comments":true,"path":"api/articles/2023-mar.json","keywords":null,"cover":"https://www.lovethispic.com/uploaded_images/158327-Hello-March.jpg","text":"3.10 重归过了差不多一年啦，我又回来写博客了起因是室友转专业闲着没事，在捣鼓建博客网站，但是跟着知乎上的教程走吧，又有点毛病，始终整不出来，我表示我之前弄过一个博客网站，但是实在是不知道写些什么，我也不是现充，天天在网上分享自己的生活、po点照片啥的，再加上也遇到不少麻烦，比...","link":"","photos":[],"count_time":{"symbolsCount":567,"symbolsTime":"1 mins."},"categories":[{"name":"Thoughts","slug":"Thoughts","count":9,"path":"api/categories/Thoughts.json"}],"tags":[{"name":"Life","slug":"Life","count":9,"path":"api/tags/Life.json"},{"name":"Monthly","slug":"Monthly","count":9,"path":"api/tags/Monthly.json"}],"author":{"name":"Krodnel","slug":"blog-author","avatar":"https://s1.ax1x.com/2022/03/06/brFqER.png","link":"/","description":"I don't live in a dream <br /> The dream is my reality","socials":{"github":"https://github.com/godofborder","twitter":"https://twitter.com/godofborder","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili-line.svg","link":"https://space.bilibili.com/34360575"},"QQ":{"icon":"/svg/QQ.svg","link":"http://wpa.qq.com/msgrd?v=3&uin=2632954297&site=qq&menu=yes"},"netease":{"icon":"/svg/netease.svg","link":"http://music.163.com/playlist?id=688977586&userid=337229589"},"steam":{"icon":"/svg/steam.svg","link":"https://steamcommunity.com/id/Krodnel/"}}}},"feature":true},"next_post":{"title":"PYTHON第4章扩展习题","uid":"3dac8a3b916e2b92a60024738a9872dc","slug":"python-cp4-ex","date":"2022-03-14T15:48:02.000Z","updated":"2022-04-02T14:29:36.225Z","comments":true,"path":"api/articles/python-cp4-ex.json","keywords":null,"cover":"https://s1.ax1x.com/2022/03/14/bjepjg.jpg","text":"Chapter4. 列表(EX)4.A 程序片段练习4.A.1 嵌套列表元素求和【问题描述】 输入一个嵌套列表，嵌套层次不限，求列表元素的和。这个列表的每个元素是整数。 【输入形式】 嵌套列表【输出形式】 整数【样例输入】 [1,2,3,[4,5,6,7],8] 【样例输出】 3...","link":"","photos":[],"count_time":{"symbolsCount":"5.6k","symbolsTime":"5 mins."},"categories":[{"name":"Learning","slug":"Learning","count":3,"path":"api/categories/Learning.json"},{"name":"Coding","slug":"Learning/Coding","count":3,"path":"api/categories/Learning/Coding.json"},{"name":"Python","slug":"Learning/Coding/Python","count":3,"path":"api/categories/Learning/Coding/Python.json"}],"tags":[{"name":"life","slug":"life","count":3,"path":"api/tags/life.json"},{"name":"weekly","slug":"weekly","count":4,"path":"api/tags/weekly.json"}],"author":{"name":"Krodnel","slug":"blog-author","avatar":"https://s1.ax1x.com/2022/03/06/brFqER.png","link":"/","description":"I don't live in a dream <br /> The dream is my reality","socials":{"github":"https://github.com/godofborder","twitter":"https://twitter.com/godofborder","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili-line.svg","link":"https://space.bilibili.com/34360575"},"QQ":{"icon":"/svg/QQ.svg","link":"http://wpa.qq.com/msgrd?v=3&uin=2632954297&site=qq&menu=yes"},"netease":{"icon":"/svg/netease.svg","link":"http://music.163.com/playlist?id=688977586&userid=337229589"},"steam":{"icon":"/svg/steam.svg","link":"https://steamcommunity.com/id/Krodnel/"}}}},"feature":true}}